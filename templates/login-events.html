<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - Kalakosh</title>
    <!-- Link to your custom estyle.css -->
    <link rel="stylesheet" href="/static/lestyle.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">
    <!-- Google Fonts for Kalakosh branding -->
    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@400;700&family=Quintessential&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Almendra+SC:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lugrasimo&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Artifika&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=PT+Serif+Caption:ital@0;1&display=swap" rel="stylesheet">
    <style>
        /* Custom Fonts */
        .font-mukta { font-family: 'Mukta', sans-serif; }
        .font-quintessential { font-family: 'Quintessential', cursive; }
        .font-almendra-sc { font-family: 'Almendra SC', serif; } /* Added from events.html */
        .font-lugrasimo { font-family: 'Lugrasimo', cursive; } /* Added from events.html */
        .font-artifika { font-family: 'Artifika', serif; } /* Added from events.html */
        .font-pt-serif-caption { font-family: 'PT Serif Caption', serif; } /* Added from events.html */
    </style>
</head>

<body>
    <header>
        <div class="header">
            <div class="logo"><img src="/static/images/logo1.jpg" alt="kalakosh logo"></div>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/states">Art Forms</a>
                <a href="/login-events" class="active">Events</a>
                <a href="/login">Login</a>
                <a href="/contact"><i class="fas fa-user"></i> Contact </a>
            </div>
        </div>
    </header>

    <main>
        <section class="hero-section">
            <div class="hero-text">
                <h1>Where Indian Art Comes Alive</h1>
                <p class="tagline">A blend of workshops, heritage stories, and handmade legacies brought together beautifully.</p>
                <a href="#a" class="hero-btn">Explore Events</a>
            </div>
        </section>

        <div class="full">
            <section class="calendar-wrapper">
                <h1 id="topic">Events Calendar</h1>
                <br>
                <div class="calendar-box">
                    <div class="calendar-header">
                        <span class="arrow">&#10094;</span>
                        <span class="month">July 2024</span>
                        <span class="arrow">&#10095;</span>
                    </div>
                    <div class="calendar-days">
                        <div> S </div>
                        <div> M </div>
                        <div> T </div>
                        <div> W </div>
                        <div> T </div>
                        <div> F </div>
                        <div> S </div>
                    </div>
                    <div class="calendar-dates">
                        <div class="inactive"></div>
                        <div>1</div>
                        <div>2</div>
                        <div class="active">3</div>
                        <div>4</div>
                        <div>5</div>
                        <div>6</div>
                        <div class="active">7</div>
                        <div>8</div>
                        <div>9</div>
                        <div>10</div>
                        <div>11</div>
                        <div>12</div>
                        <div class="active">13</div>
                        <div>14</div>
                        <div>15</div>
                        <div>16</div>
                        <div>17</div>
                        <div class="active">18</div>
                        <div>19</div>
                        <div>20</div>
                        <div>21</div>
                        <div>22</div>
                        <div>23</div>
                        <div class="active">24</div>
                        <div>25</div>
                        <div>26</div>
                        <div>27</div>
                        <div>28</div>
                        <div>29</div>
                        <div>30</div>
                        <div>31</div>
                    </div>
                </div>
            </section>

            <div class="calendar-events">
                <h1 id="topic">Upcoming Workshops & Exhibitions</h1>
                <br>
                <hr />
                <!-- Dynamic Upcoming Events will be loaded here -->
                <div id="upcomingEventsDynamicList">
                    <p class="text-gray-500 text-center py-10">Loading upcoming events...</p>
                </div>
            </div>
        </div>

        <br />
        <div class="opt">
            <section class="innernav">
                <div><a href="#workshops">Workshops</a></div>
                <div><a href="#exhibitions">Exhibitions</a></div>
                <div><a href="#past-events">Past Events</a></div>
                <div><a href="#artists">Artists</a></div>
                <div><a href="#reviews">Reviews</a></div>
            </section>

            <div class="content-section">
                <img src="/static/images/Leftdesign.png" class="design-image" alt="Left Design">
                <p class="section-title">Workshops</p>
                <img src="/static/images/rightdesign.png" class="design-image" alt="Right Design">
            </div>

            <section class="event-grid" id="workshops">
                <!-- Dynamic Workshop Cards will be loaded here -->
                <p class="text-gray-500 text-center py-10 col-span-full" id="workshopLoading">Loading workshops...</p>
            </section>

            <div class="content-section">
                <img src="/static/images/Leftdesign.png" class="design-image" alt="Left Design">
                <p class="section-title">Exhibitions</p>
                <img src="/static/images/rightdesign.png" class="design-image" alt="Right Design">
            </div>

            <section class="exhibitions-section" id="exhibitions">
                <!-- Dynamic Exhibition Cards will be loaded here -->
                <p class="text-gray-500 text-center py-10 col-span-full" id="exhibitionLoading">Loading exhibitions...</p>
            </section>
            <!-- Add sections for Past Events, Artists, Reviews as needed -->
        </div>
    </main>

    <footer>
        <div class="footer-container">
            <!-- About Kalakosh -->
            <div class="footer-section about">
                <h3>About Kalakosh</h3>
                <p>
                    Kalakosh is a vibrant platform dedicated to preserving and promoting the rich cultural heritage of Indian art, showcasing diverse folk, tribal, and classical artforms across every state.
                </p>
            </div>

            <!-- Quick Links -->
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/states">Art Form</a></li>
                    <li><a href="/login-events">Events</a></li>
                    <li><a href="/contact">Contact us</a></li>
                    <li><a href="/login">Log in</a></li>
                </ul>
            </div>

            <!-- Explore By Theme -->
            <div class="footer-section">
                <h3>Explore By Theme</h3>
                <ul>
                    <li><a href="#">Folk Paintings</a></li>
                    <li><a href="#">Classical Dance</a></li>
                    <li><a href="#">Handicrafts</a></li>
                    <li><a href="#">Tribal Art</a></li>
                    <li><a href="#">Artisan Stories</a></li>
                </ul>
            </div>

            <!-- Stay Connected -->
            <div class="footer-section">
                <h3>Stay Connected</h3>
                <p>Follow us on:</p>
                <div class="social-links">
                    <a href="https://www.instagram.com"><i class="bx bxl-instagram"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="https://www.facebook.com"><i class="bx bxl-facebook"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="https://www.youtube.com"><i class="bx bxl-youtube"></i></a>
                </div>
                <form class="newsletter-form">
                    <input type="email" placeholder="Your email">
                    <button type="submit">Subscribe</button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Kalakosh. All rights reserved.</p>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDQuFoRR5n9nvx0nq2HnbJlHQlugcd1jfM",
            authDomain: "kalakosh-website-bd6a6.firebaseapp.com",
            projectId: "kalakosh-website-bd6a6",
            storageBucket: "kalakosh-website-bd6a6.firebasestorage.app",
            messagingSenderId: "1093917835204",
            appId: "1:1093917835204:web:d93e71b98c03393cb0ae91",
            measurementId: "G-F7N10Z0RGC"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        const upcomingEventsDynamicList = document.getElementById('upcomingEventsDynamicList');
        const workshopLoading = document.getElementById('workshopLoading');
        const exhibitionLoading = document.getElementById('exhibitionLoading');
        const workshopsGrid = document.getElementById('workshops');
        const exhibitionsSection = document.getElementById('exhibitions');

        // Function to load and display events
        async function loadEvents() {
            if (!db || !currentAppId) {
                console.error("Firebase not initialized. Cannot load events.");
                upcomingEventsDynamicList.innerHTML = "<p class='text-red-500 text-center py-10'>Error: Firebase not initialized.</p>";
                workshopLoading.textContent = "Error: Firebase not initialized.";
                exhibitionLoading.textContent = "Error: Firebase not initialized.";
                return;
            }

            // Clear existing content and show loading messages
            upcomingEventsDynamicList.innerHTML = '';
            workshopsGrid.innerHTML = '';
            exhibitionsSection.innerHTML = '';

            workshopLoading.classList.remove('hidden');
            exhibitionLoading.classList.remove('hidden');

            try {
                const eventsCollectionRef = collection(db, `artifacts/${currentAppId}/public/data/events`);
                const q = query(eventsCollectionRef, orderBy('date', 'asc')); // Order by date for upcoming events

                onSnapshot(q, (snapshot) => {
                    const allEvents = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    console.log("Fetched events for public display:", allEvents); // Debugging

                    const now = new Date();
                    now.setHours(0, 0, 0, 0); // Normalize to start of today

                    const upcomingEvents = [];
                    const workshops = [];
                    const exhibitions = [];

                    allEvents.forEach(event => {
                        const eventDate = new Date(event.date); // Assuming event.date is in YYYY-MM-DD format
                        if (eventDate >= now) { // Only include future or current events
                            upcomingEvents.push(event);
                            if (event.type === 'Workshop') {
                                workshops.push(event);
                            } else if (event.type === 'Exhibition') {
                                exhibitions.push(event);
                            }
                        }
                    });

                    // Render Upcoming Events (Calendar Events section)
                    if (upcomingEvents.length === 0) {
                        upcomingEventsDynamicList.innerHTML = "<p class='text-gray-500 text-center py-10'>No upcoming events or workshops scheduled yet.</p>";
                    } else {
                        upcomingEvents.forEach(event => {
                            const eventItem = document.createElement('div');
                            eventItem.className = "event-item";
                            eventItem.innerHTML = `
                                <h4>${event.title}</h4>
                                <p>${event.description}</p>
                                <div class="half">
                                    <div id="da"><strong>Date:</strong> ${event.date}</div>
                                    <div><button><a href="/login-register?event_id=${event.id}">Details</a></button></div>
                                </div>
                                <hr />
                            `;
                            upcomingEventsDynamicList.appendChild(eventItem);
                        });
                    }

                    // Render Workshops
                    workshopLoading.classList.add('hidden');
                    if (workshops.length === 0) {
                        workshopsGrid.innerHTML = "<p class='text-gray-500 text-center py-10 col-span-full'>No workshops available at the moment.</p>";
                    } else {
                        workshops.forEach(event => {
                            const workshopCard = document.createElement('div');
                            workshopCard.className = "event-card";
                            workshopCard.innerHTML = `
                                <img src="${event.imageUrl || 'https://placehold.co/400x300/CCCCCC/333333?text=Event+Image'}" alt="${event.title}">
                                <div class="event-details">
                                    <h3>${event.title}</h3>
                                    <div class="instructor">
                                        <img src="${event.instructorImage || 'https://placehold.co/50x50/DDDDDD/666666?text=I'}" alt="Instructor" />
                                        <span>by ${event.instructorName || 'Unknown Instructor'}</span>
                                    </div>
                                    <div class="event-meta">Date: ${event.date} | Time: ${event.time}</div>
                                    <div class="event-price">${event.price === 'Free' ? 'Free' : `â‚¹${event.price}`}</div>
                                    <div class="event-actions">
                                        <button class="register"><a href="/login-register?event_id=${event.id}">Register Now</a></button>
                                        <button class="details">View Details</button>
                                    </div>
                                </div>
                            `;
                            workshopsGrid.appendChild(workshopCard);
                        });
                    }

                    // Render Exhibitions
                    exhibitionLoading.classList.add('hidden');
                    if (exhibitions.length === 0) {
                        exhibitionsSection.innerHTML = "<p class='text-gray-500 text-center py-10 col-span-full'>No exhibitions available at the moment.</p>";
                    } else {
                        exhibitions.forEach(event => {
                            const exhibitionCard = document.createElement('div');
                            exhibitionCard.className = "exhibition-card"; // Assuming you have a separate style for exhibitions
                            exhibitionCard.innerHTML = `
                                <div class="exhibition-image">
                                    <img src="${event.imageUrl || 'https://placehold.co/400x300/CCCCCC/333333?text=Exhibition+Image'}" alt="${event.title}">
                                </div>
                                <div class="exhibition-content">
                                    <h3>${event.title}</h3>
                                    <p>${event.description}</p>
                                    <p><strong>Venue:</strong> ${event.location}</p>
                                    <p><strong>Event Timing:</strong> ${event.date}, ${event.time}</p>
                                    <div class="buttons">
                                        <a href="/login-register?event_id=${event.id}" class="btn">Register / Details</a>
                                        <!-- Add more buttons like Meet the Artist, Buy Art if applicable -->
                                    </div>
                                </div>
                            `;
                            exhibitionsSection.appendChild(exhibitionCard);
                        });
                    }

                }, (err) => {
                    console.error("Error fetching events:", err);
                    upcomingEventsDynamicList.innerHTML = `<p class='text-red-500 text-center py-10'>Error loading events: ${err.message}</p>`;
                    workshopLoading.textContent = `Error loading workshops: ${err.message}`;
                    exhibitionLoading.textContent = `Error loading exhibitions: ${err.message}`;
                });
            } catch (err) {
                console.error("Error in loadEvents setup:", err);
                upcomingEventsDynamicList.innerHTML = `<p class='text-red-500 text-center py-10'>An error occurred: ${err.message}</p>`;
                workshopLoading.textContent = `An error occurred: ${err.message}`;
                exhibitionLoading.textContent = `An error occurred: ${err.message}`;
            }
        }

        window.onload = loadEvents;
    </script>
</body>
</html>
